<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>谁没提交！</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script>
        function process() {
            // 约定输入的数据格式必须是：楼号\t室号\t商品\t数量\t跟团
            var input = $('#input').val().trim().split('\n');
            var regex = /(\d+)[另 ]?号/;
            var result = [];
            var missing = [];
            var skipped = [];
            var allNums = $('#allNums').val().split(',');
            input.forEach((row, i) => {
                if (row.includes('楼') || row.includes('号')) {
                    var numResult = row.match(regex);
                    if (numResult) {
                        result.push(numResult[1]);
                    } else {
                        // 数据奇葩，请人工修正后再试
                        skipped.push(row);
                    }
                } else {
                    skipped.push(row);
                }
            });

            allNums.forEach(num => {
                if (!result.includes(num)) {
                    missing.push(num);
                }
            });
            var output = [];
            missing.forEach((item) => {
                output.push(item + '号楼');
                console.log(item + '号楼');
            });
            output.push('请以上楼栋尽快提交检测结果！');
            $('#output').val(output.join('\n'));
            $('#output').select();
            $('#skipped').val(skipped.join('\n'));
            navigator.clipboard.writeText($('#output').val());
        }
    </script>
</head>
<body>
<textarea id="input" rows="10" cols="50" placeholder="把楼栋接龙数据复制到这里……"></textarea><br/>
<button id="process" onclick="process();">谁没提交！</button>
<label for="allNums">有效楼栋号：</label><input type="text" id="allNums" value="1,2,3,4,5,6,7,8,9,12,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32">
<br/>
<textarea id="output" rows="10" cols="50" placeholder="点击【谁没提交！】，没提交的会显示在这里"></textarea>
<br/>
<textarea id="skipped" rows="10" cols="50" placeholder="无效数据会显示在这里，备查"></textarea>
</body>
</html>